# Snapshot: Deep Diagnostic - Why Phase 6 Refactor Failed

**Time**: 2026-01-14 14:05
**Context**: ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£ Refactor ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (Selectors ‡∏û‡∏±‡∏á, ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ, ‡∏ï‡∏¥‡∏î Retry loop)

## üîç Root Cause Analysis (‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á)

### 1. Selector Collision & Invalid Syntax
- **‡∏õ‡∏±‡∏ç‡∏´‡∏≤**: ‡πÉ‡∏ô `video-gen.js` ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `configureVideoSettings` ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `:has-text("Tune")` ‡πÅ‡∏•‡∏∞ `:has(i:has-text("tune"))` 
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á**: `document.querySelector` (‡∏ã‡∏∂‡πà‡∏á‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏î‡∏¢ `findElement`) ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Syntax ‡∏ô‡∏µ‡πâ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏° Tune ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ (Error: Element not found after 5000ms) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Veo 3.1 Âéª

### 2. File Input Polling Failure (The Retry Loop)
- **‡∏õ‡∏±‡∏ç‡∏´‡∏≤**: ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ `File input did not appear after clicking add button at index 0`
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á**: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏≤ File input ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Error ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á **Retry** ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ `FlowStateMachine` ‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° `FILL_IMAGES` ‡πÉ‡∏´‡∏°‡πà (‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥‡πÜ ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏´‡πá‡∏ô)
- **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ**: ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Frames to Video, ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠ `humanClick` ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠ File input ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ

### 3. Data Source Mystery (Character vs Generated)
- **‡∏õ‡∏±‡∏ç‡∏´‡∏≤**: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Character image ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Generated image
- **‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå**: ‡πÉ‡∏ô `shared-handlers.js` ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `generatedImageUrl` ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô Character ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤:
    - `product` object ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô Video Flow **‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï** ‡∏Ñ‡πà‡∏≤ `generatedImageUrl` ‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
    - ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Data fallback ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏™‡∏±‡∏Å‡πÅ‡∏´‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°

### 4. Prompt Logic Gap
- **‡∏õ‡∏±‡∏ç‡∏´‡∏≤**: Prompt ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏° ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πâ‡∏≠‡∏ô JSON ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á**: ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô `FILL_IMAGES` (Error/Retry loop)

## üõ°Ô∏è Corrective Action Plan (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

1. **Standardize Selectors**: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏∏‡πà‡∏° Tune ‡∏î‡πâ‡∏ß‡∏¢ `i.google-symbols` ‡∏Å‡∏±‡∏ö text match 'tune' ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤
2. **Robust File Input Polling**: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠ File input ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Video ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
3. **Explicit Data Logging**: ‡πÄ‡∏û‡∏¥‡πà‡∏° Log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡πà‡∏≤ URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ `uploadImageViaAddButton` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
4. **JSON Prompt Support**: ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤ `videoPrompt` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å stringify ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏•‡∏á Textarea

## Tags
`diagnostic` `bug-report` `selector-error` `video-gen` `retry-loop`
