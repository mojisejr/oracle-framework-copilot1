# Snapshot: Google Flow v4.4 Fix (Identity + Proximity)

**Time**: 2026-01-15 00:04
**Context**: Fixing the "Tune" button misclick issue in Video FX automation.

## Problem (The "Edit Project" Trap)
The "Edit Project" button in the `<header>` matches the same robust identity criteria as the "Tune" button in the content area:
1. `aria-haspopup="dialog"`
2. Visible or hidden text containing "Settings" (or icon "Tune").

Since `querySelectorAll` returns elements in DOM order (Top-down), the Header button was always found first. v4.3 (Universal Identity) failed because it assumed the first match was correct.

## Solution (v4.4 Identity + Proximity)
Implemented a 3-layer filtering system in `configureSettings()`:

1. **Header Exclusion**: Explicitly skip any candidate matching `btn.closest('header')`.
2. **Anchor Grounding**: Locate the Prompt Textarea (`#PINHOLE_TEXT_AREA_ELEMENT_ID`) to establish a "center of gravity".
3. **Proximity Scoring**: Calculate the vertical distance (`Math.abs(diffY)`) between each candidate and the Anchor. Select the candidate with the **minimum distance**.

## Code Change
Refactored `flow-content-script.js`:
- Added `promptTextarea` detection.
- Added loop logic to track `minDistance` and `bestCandidate`.
- Added exclusion for header elements.

## Tags
`google-flow` `automation` `bug-fix` `v4.4` `proximity-search`
